using System;
using System.Linq;
using System.Collections.Generic;
using CurrentDesk.DAL;
using CurrentDesk.Models;

//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated from a template at 15-07-13 10:25:32 AM
//	   and this file should not get overridden 
//
//     Add your own data access methods.
// </auto-generated>
//------------------------------------------------------------------------------ 
	
namespace CurrentDesk.Repository.CurrentDesk
{   
	public class OrganizationBO
	{
		// Add your own data access methods here.  If you wish to
		// expose your public method to a WCF service, marked them with
		// the attribute [NCPublish], and another T4 template will generate your service contract
		
        /// <summary>
        /// This Function Will Get The Organization ID 
        /// from the given URL
        /// </summary>
        /// <param name="url">URL</param>
        /// <returns>Organization ID</returns>
        public int? GetOrganizationIDFromURL(string url)
        {
           
            try
            {
                using (var unitOfWork = new EFUnitOfWork())
                {
                    var organizationRepo = new OrganizationRepository(new EFRepository<Organization>(), unitOfWork);
                    var OrganizationList = ((CurrentDeskClientsEntities)organizationRepo.Repository.UnitOfWork.Context).
                                            Organizations.ToList();

                    //Loop Through The Organization List
                    //And Match With Respective URL
                    foreach (var item in OrganizationList)
                    {
                        if (url.ToLower().Contains(item.OrganizationKey))
                        {
                            return item.PK_OrganizationID;
                        }
                    }
                }

                return null;
            }
            catch (Exception exceptionMessage)
            {
                CommonErrorLogger.CommonErrorLog(exceptionMessage, System.Reflection.MethodBase.GetCurrentMethod().Name);
                return null;
            }
        }
	}
}